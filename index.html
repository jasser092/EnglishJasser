<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªØ¹Ù„Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© - English Learning App</title>
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø³ÙŠØ· Ù„ØªØ¹Ù„Ù… Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ù…Ø¹ Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØªÙŠ">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 420px;
            margin: 20px auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 26px;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 15px;
        }
        
        .audio-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .audio-btn {
            background: #3498db;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 600;
        }
        
        .audio-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .english-word {
            background: #f8f9fa;
            padding: 30px 25px;
            border-radius: 16px;
            margin-bottom: 25px;
            border: 3px solid #3498db;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.2);
        }
        
        .english-word h2 {
            font-size: 34px;
            color: #000000;
            font-weight: bold;
            margin: 0;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .speaker-btn {
            background: none;
            border: none;
            font-size: 22px;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: all 0.3s ease;
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .speaker-btn:hover {
            background: #ecf0f1;
            transform: translateY(-50%) scale(1.1);
        }
        
        .speaker-btn.speaking {
            color: #e74c3c;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: translateY(-50%) scale(1); }
            50% { transform: translateY(-50%) scale(1.15); }
            100% { transform: translateY(-50%) scale(1); }
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .option-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 17px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }
        
        .option-btn:hover {
            background: #2980b9;
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.4);
        }
        
        .option-btn:active {
            transform: translateY(-1px);
        }
        
        .option-btn.correct {
            background: #27ae60;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4);
        }
        
        .option-btn.wrong {
            background: #e74c3c;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
        }
        
        .option-btn:disabled {
            transform: none;
            box-shadow: none;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            background: #9b59b6;
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 3px 8px rgba(155, 89, 182, 0.3);
        }
        
        .control-btn:hover:not(:disabled) {
            background: #8e44ad;
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(155, 89, 182, 0.4);
        }
        
        .control-btn.exit-btn {
            background: #e74c3c;
            box-shadow: 0 3px 8px rgba(231, 76, 60, 0.3);
        }
        
        .control-btn.exit-btn:hover {
            background: #c0392b;
        }
        
        .control-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .stats {
            margin-top: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #ecf0f1 0%, #dfe6e9 100%);
            border-radius: 12px;
            font-size: 14px;
            color: #2c3e50;
            text-align: center;
            font-weight: 600;
            border: 2px solid #bdc3c7;
        }

        .add-words-section {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #3498db;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.1);
        }

        .add-words-section h3 {
            margin-bottom: 15px;
            text-align: center;
            color: #2c3e50;
            font-size: 18px;
            font-weight: 700;
        }

        .add-words-section textarea {
            width: 100%;
            height: 140px;
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 12px;
            resize: vertical;
            transition: border 0.3s ease;
            font-family: inherit;
        }

        .add-words-section textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .add-words-section button {
            background: #27ae60;
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            width: 100%;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(39, 174, 96, 0.3);
        }

        .add-words-section button:hover {
            background: #219a52;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(39, 174, 96, 0.4);
        }

        .message {
            padding: 12px;
            margin: 12px 0;
            border-radius: 8px;
            text-align: center;
            font-size: 15px;
            font-weight: bold;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }

        .message.correct {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .message.wrong {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .session-stats {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .session-stats h3 {
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 700;
        }

        .session-stats p {
            margin: 8px 0;
            font-size: 15px;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 24px;
            background: #ecf0f1;
            border-radius: 12px;
            margin: 15px 0;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }

        .progress {
            height: 100%;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            border-radius: 12px;
            transition: width 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .english-word h2 {
                font-size: 28px;
            }
            
            .option-btn {
                padding: 16px;
                font-size: 16px;
            }
            
            .control-btn {
                padding: 10px 15px;
                font-size: 13px;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ Ù…ØªØ¹Ù„Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</h1>
            <p>Ø§Ø®ØªØ± Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„Ù„ÙƒÙ„Ù…Ø© - Learn English Words</p>
        </div>

        <!-- Audio Controls -->
        <div class="audio-controls">
            <button class="audio-btn" onclick="toggleAutoSpeak()">
                <span id="autoSpeakIcon">ğŸ”Š</span>
                <span id="autoSpeakText">Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</span>
            </button>
            <button class="audio-btn" onclick="repeatPronunciation()">
                ğŸ”„ ÙƒØ±Ø± Ø§Ù„Ù†Ø·Ù‚
            </button>
        </div>

        <!-- Feedback Message -->
        <div id="message" class="message" style="display: none;"></div>

        <!-- English Word -->
        <div class="english-word">
            <h2 id="englishWord">Loading...</h2>
            <button class="speaker-btn" onclick="speakCurrentWord()">ğŸ”Š</button>
        </div>

        <!-- Translation Options -->
        <div class="options">
            <button class="option-btn" onclick="checkAnswer(0)">...</button>
            <button class="option-btn" onclick="checkAnswer(1)">...</button>
            <button class="option-btn" onclick="checkAnswer(2)">...</button>
        </div>

        <!-- Control Buttons -->
        <div class="controls">
            <button class="control-btn" onclick="toggleAddWords()">â• Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ù…Ø§Øª</button>
            <button class="control-btn" onclick="skipWord()" style="background: #e67e22;">â­ï¸ ØªØ®Ø·ÙŠ</button>
            <button class="control-btn exit-btn" onclick="showSessionStats()">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
        </div>

        <!-- Statistics -->
        <div class="stats" id="stats">
            Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
        </div>

        <!-- Add Words Section -->
        <div id="addWordsPanel" class="add-words-section" style="display: none;">
            <h3>Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ù…Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</h3>
            <textarea id="wordsTextarea" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø¨Ø§Ù„ØµÙŠØºØ©: english=Ø¹Ø±Ø¨ÙŠ
Ù…Ø«Ø§Ù„:
book=ÙƒØªØ§Ø¨
water=Ù…Ø§Ø¡
computer=Ø­Ø§Ø³ÙˆØ¨

ÙŠÙ…ÙƒÙ†Ùƒ Ù„ØµÙ‚ Ù‚Ø§Ø¦Ù…Ø© ÙƒØ§Ù…Ù„Ø© Ù…Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù‡Ù†Ø§..."></textarea>
            <button onclick="addMultipleWords()">ğŸ’¾ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ„Ù…Ø§Øª</button>
            <div style="margin-top: 15px; text-align: center;">
                <button class="control-btn" onclick="addDefaultWords()" style="background: #e67e22; width: auto; padding: 10px 20px;">
                    ğŸ“š Ø¥Ø¶Ø§ÙØ© 1000 ÙƒÙ„Ù…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                </button>
            </div>
        </div>

        <!-- Session Statistics -->
        <div id="sessionStats" class="session-stats" style="display: none;">
            <h3>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¬Ù„Ø³Ø©</h3>
            <p id="sessionInfo">ØªÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ 0 ÙƒÙ„Ù…Ø©</p>
            <p id="sessionCorrect">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©: 0</p>
            <p id="sessionPercentage">Ø§Ù„Ù†Ø³Ø¨Ø©: 0%</p>
            <div class="progress-bar">
                <div id="progressFill" class="progress" style="width: 0%"></div>
            </div>
            <button class="control-btn" onclick="hideSessionStats()" style="background: #3498db; margin-top: 15px; width: auto; padding: 10px 25px;">
                â¡ï¸ Ø§Ø³ØªÙ…Ø±Ø§Ø±
            </button>
            <button class="control-btn exit-btn" onclick="resetSession()" style="margin-top: 10px; width: auto; padding: 8px 20px;">
                ğŸ”„ Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©
            </button>
        </div>
    </div>

    <script>
        // Text-to-Speech Service
        class TTSService {
            constructor() {
                this.synth = window.speechSynthesis;
                this.voices = [];
                this.selectedVoice = null;
                this.isSupported = false;
                this.isInitialized = false;
                this.rate = 1.0;
                this.pitch = 1.0;
                this.volume = 1.0;
                
                this.init();
            }

            init() {
                if (!this.synth) {
                    console.warn('Text-to-Speech ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­');
                    return;
                }

                this.isSupported = true;
                this.loadVoices();
                
                this.synth.onvoiceschanged = () => {
                    this.loadVoices();
                };
            }

            loadVoices() {
                this.voices = this.synth.getVoices();
                
                // Select English voice
                this.selectedVoice = this.voices.find(voice => 
                    voice.lang.includes('en-US')
                ) || this.voices.find(voice => 
                    voice.lang.includes('en')
                ) || this.voices[0];
                
                this.isInitialized = true;
                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø¨Ù†Ø¬Ø§Ø­');
            }

            speak(text) {
                if (!this.isSupported || !this.isInitialized) {
                    console.warn('TTS ØºÙŠØ± Ø¬Ø§Ù‡Ø²');
                    return false;
                }

                this.stop();

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.voice = this.selectedVoice;
                utterance.rate = this.rate;
                utterance.pitch = this.pitch;
                utterance.volume = this.volume;

                utterance.onstart = () => {
                    document.querySelector('.speaker-btn').classList.add('speaking');
                };

                utterance.onend = () => {
                    document.querySelector('.speaker-btn').classList.remove('speaking');
                };

                utterance.onerror = (error) => {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø·Ù‚:', error);
                    document.querySelector('.speaker-btn').classList.remove('speaking');
                };

                this.synth.speak(utterance);
                return true;
            }

            stop() {
                if (this.isSupported) {
                    this.synth.cancel();
                }
            }

            setRate(rate) {
                this.rate = Math.max(0.1, Math.min(2, rate));
            }

            setPitch(pitch) {
                this.pitch = Math.max(0.1, Math.min(2, pitch));
            }

            isSpeaking() {
                return this.isSupported ? this.synth.speaking : false;
            }
        }

        // Initialize TTS Service
        const ttsService = new TTSService();

        // Word Database
        let words = [
            { english: "Book", correct: "ÙƒØªØ§Ø¨", wrong1: "Ù‚Ù„Ù…", wrong2: "Ù…Ø¯Ø±Ø³Ø©" },
            { english: "She", correct: "Ù‡ÙŠ", wrong1: "Ù‡Ùˆ", wrong2: "Ù‡Ù…" },
            { english: "Red", correct: "Ø£Ø­Ù…Ø±", wrong1: "Ø£Ø²Ø±Ù‚", wrong2: "Ø£Ø®Ø¶Ø±" },
            { english: "House", correct: "Ù…Ù†Ø²Ù„", wrong1: "Ø³ÙŠØ§Ø±Ø©", wrong2: "Ø´Ø¬Ø±Ø©" },
            { english: "Water", correct: "Ù…Ø§Ø¡", wrong1: "Ù†Ø§Ø±", wrong2: "Ù‡ÙˆØ§Ø¡" },
            { english: "Cat", correct: "Ù‚Ø·Ø©", wrong1: "ÙƒÙ„Ø¨", wrong2: "Ø·Ø§Ø¦Ø±" },
            { english: "School", correct: "Ù…Ø¯Ø±Ø³Ø©", wrong1: "Ø¨ÙŠØª", wrong2: "Ø¹Ù…Ù„" },
            { english: "Car", correct: "Ø³ÙŠØ§Ø±Ø©", wrong1: "Ø·Ø§Ø¦Ø±Ø©", wrong2: "Ù‚Ø·Ø§Ø±" }
        ];

        let usedIndices = [];
        let correctAnswers = 0;
        let autoSpeak = true;
        let currentWord = null;
        
        // Session Statistics
        let sessionAnswers = 0;
        let sessionCorrect = 0;
        let autoNextTimer = null;

        // Initialize App
        function init() {
            checkTTSSupport();
            loadWords();
            showRandomWord();
            updateStats();
            
            // Register Service Worker for PWA
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => console.log('âœ… Service Worker registered'))
                    .catch(error => console.log('âŒ Service Worker registration failed:', error));
            }
        }

        // Check TTS Support
        function checkTTSSupport() {
            if (!ttsService.isSupported) {
                document.getElementById('autoSpeakIcon').textContent = 'ğŸ”‡';
                document.getElementById('autoSpeakText').textContent = 'Ø§Ù„Ù†Ø·Ù‚ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…';
            }
        }

        // Load words from localStorage
        function loadWords() {
            const savedWords = localStorage.getItem('englishWords');
            if (savedWords) {
                try {
                    words = JSON.parse(savedWords);
                } catch (e) {
                    console.error('Error loading words:', e);
                }
            }
            const savedScore = localStorage.getItem('correctAnswers');
            if (savedScore) {
                correctAnswers = parseInt(savedScore) || 0;
            }
        }

        // Save words to localStorage
        function saveWords() {
            localStorage.setItem('englishWords', JSON.stringify(words));
            localStorage.setItem('correctAnswers', correctAnswers.toString());
        }

        // Show random word
        function showRandomWord() {
            // Clear any existing timer
            if (autoNextTimer) {
                clearTimeout(autoNextTimer);
                autoNextTimer = null;
            }

            // Reset used indices if all words used
            if (usedIndices.length >= words.length) {
                usedIndices = [];
            }

            // Select random unused word
            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * words.length);
            } while (usedIndices.includes(randomIndex) && words.length > usedIndices.length);

            usedIndices.push(randomIndex);
            currentWord = words[randomIndex];
            
            displayWord(currentWord);
        }

        // Display word with options
        function displayWord(word) {
            document.getElementById('englishWord').textContent = word.english;
            
            const options = document.querySelectorAll('.option-btn');
            const allOptions = [word.correct, word.wrong1, word.wrong2];
            
            // Shuffle options
            for (let i = allOptions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allOptions[i], allOptions[j]] = [allOptions[j], allOptions[i]];
            }
            
            options.forEach((btn, index) => {
                btn.textContent = allOptions[index];
                btn.className = 'option-btn';
                btn.disabled = false;
            });
            
            // Hide message and next button
            document.getElementById('message').style.display = 'none';
            
            // Auto-speak if enabled
            if (autoSpeak) {
                setTimeout(() => {
                    speakCurrentWord();
                }, 400);
            }
        }

        // Speak current word
        function speakCurrentWord() {
            const currentWordText = document.getElementById('englishWord').textContent;
            ttsService.speak(currentWordText);
        }

        // Repeat pronunciation
        function repeatPronunciation() {
            speakCurrentWord();
        }

        // Toggle auto-speak
        function toggleAutoSpeak() {
            autoSpeak = !autoSpeak;
            const icon = document.getElementById('autoSpeakIcon');
            const text = document.getElementById('autoSpeakText');
            
            if (autoSpeak) {
                icon.textContent = 'ğŸ”Š';
                text.textContent = 'Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ';
            } else {
                icon.textContent = 'ğŸ”‡';
                text.textContent = 'Ø§Ù„Ù†Ø·Ù‚ Ù…ØªÙˆÙ‚Ù';
            }
        }

        // Check answer
        function checkAnswer(selectedIndex) {
            const options = document.querySelectorAll('.option-btn');
            const selectedText = options[selectedIndex].textContent;
            const messageElement = document.getElementById('message');
            
            // Update session statistics
            sessionAnswers++;
            
            if (selectedText === currentWord.correct) {
                // Correct answer
                options.forEach(btn => {
                    btn.disabled = true;
                    if (btn.textContent === currentWord.correct) {
                        btn.classList.add('correct');
                    }
                });
                
                correctAnswers++;
                sessionCorrect++;
                saveWords();
                
                // Show success message
                messageElement.textContent = 'ğŸ‰ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! âœ“';
                messageElement.className = 'message correct';
                messageElement.style.display = 'block';
                
                // Auto next after 1 second
                autoNextTimer = setTimeout(() => {
                    showRandomWord();
                }, 1000);
                
            } else {
                // Wrong answer - show correct answer and repeat word
                options.forEach(btn => {
                    btn.disabled = true;
                    if (btn.textContent === currentWord.correct) {
                        btn.classList.add('correct');
                    } else if (btn.textContent === selectedText) {
                        btn.classList.add('wrong');
                    }
                });
                
                // Show error message
                messageElement.textContent = 'âŒ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©! Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
                messageElement.className = 'message wrong';
                messageElement.style.display = 'block';
                
                // Repeat the same word with new options after 2 seconds
                autoNextTimer = setTimeout(() => {
                    displayWord(currentWord);
                }, 2000);
            }
            
            updateStats();
        }

        // Skip to next word
        function skipWord() {
            showRandomWord();
        }

        // Update statistics
        function updateStats() {
            document.getElementById('stats').textContent = 
                `Ø§Ù„ÙƒÙ„Ù…Ø§Øª: ${words.length} | Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©: ${correctAnswers}`;
        }

        // Toggle add words panel
        function toggleAddWords() {
            const panel = document.getElementById('addWordsPanel');
            const sessionPanel = document.getElementById('sessionStats');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            sessionPanel.style.display = 'none';
        }

        // Add multiple words
        function addMultipleWords() {
            const textarea = document.getElementById('wordsTextarea');
            const lines = textarea.value.split('\n');
            let addedCount = 0;

            lines.forEach(line => {
                line = line.trim();
                if (line && line.includes('=')) {
                    const [english, arabic] = line.split('=').map(part => part.trim());
                    if (english && arabic) {
                        // Check if word already exists
                        const exists = words.some(w => w.english.toLowerCase() === english.toLowerCase());
                        if (!exists) {
                            const wrongTranslations = generateWrongTranslations(arabic);
                            words.push({
                                english: english,
                                correct: arabic,
                                wrong1: wrongTranslations[0],
                                wrong2: wrongTranslations[1]
                            });
                            addedCount++;
                        }
                    }
                }
            });

            if (addedCount > 0) {
                saveWords();
                updateStats();
                alert(`âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${addedCount} ÙƒÙ„Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ù†Ø¬Ø§Ø­!`);
                textarea.value = '';
                document.getElementById('addWordsPanel').style.display = 'none';
            } else {
                alert('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ ÙƒÙ„Ù…Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† ØµÙŠØºØ© Ø§Ù„ÙƒÙ„Ù…Ø§Øª (english=Ø¹Ø±Ø¨ÙŠ)');
            }
        }

        // Generate wrong translations
        function generateWrongTranslations(correctTranslation) {
            const commonWords = [
                'ÙƒØ¨ÙŠØ±', 'ØµØºÙŠØ±', 'Ø³Ø±ÙŠØ¹', 'Ø¨Ø·ÙŠØ¡', 'Ù‚Ø¯ÙŠÙ…', 'Ø¬Ø¯ÙŠØ¯', 'Ø¨Ø¹ÙŠØ¯', 'Ù‚Ø±ÙŠØ¨', 
                'Ø³Ù‡Ù„', 'ØµØ¹Ø¨', 'Ø·ÙˆÙŠÙ„', 'Ù‚ØµÙŠØ±', 'Ø«Ù‚ÙŠÙ„', 'Ø®ÙÙŠÙ', 'Ù‚Ø§Ø³', 'Ù„ÙŠÙ†',
                'Ø¬Ù…ÙŠÙ„', 'Ù‚Ø¨ÙŠØ­', 'Ù†Ø¸ÙŠÙ', 'ÙˆØ³Ø®', 'ØºØ§Ù„ÙŠ', 'Ø±Ø®ÙŠØµ', 'Ø³Ø§Ø®Ù†', 'Ø¨Ø§Ø±Ø¯'
            ];
            const wrongs = [];
            
            while (wrongs.length < 2) {
                const randomWord = commonWords[Math.floor(Math.random() * commonWords.length)];
                if (randomWord !== correctTranslation && !wrongs.includes(randomWord)) {
                    wrongs.push(randomWord);
                }
                
                // Prevent infinite loop
                if (wrongs.length === 0 && commonWords.length <= 2) {
                    wrongs.push('ÙƒØ¨ÙŠØ±', 'ØµØºÙŠØ±');
                    break;
                }
            }
            
            return wrongs;
        }

        // Add default words
        function addDefaultWords() {
            const defaultWords = [
                "the=Ø§Ù„", "of=Ù…Ù†", "to=Ø¥Ù„Ù‰", "and=Ùˆ", "a=Ø£", "in=ÙÙŠ", "is=ÙŠÙƒÙˆÙ†", "it=Ù‡Ùˆ", "you=Ø£Ù†Øª",
                "that=Ø°Ù„Ùƒ", "he=Ù‡Ùˆ", "was=ÙƒØ§Ù†", "for=Ù„", "on=Ø¹Ù„Ù‰", "are=ÙŠÙƒÙˆÙ†", "with=Ù…Ø¹", "as=Ùƒ",
                "I=Ø£Ù†Ø§", "his=Ù„Ù‡", "they=Ù‡Ù…", "be=ÙŠÙƒÙˆÙ†", "at=ÙÙŠ", "one=ÙˆØ§Ø­Ø¯", "have=ÙŠÙ…Ù„Ùƒ", "this=Ù‡Ø°Ø§",
                "from=Ù…Ù†", "by=Ø¨ÙˆØ§Ø³Ø·Ø©", "word=ÙƒÙ„Ù…Ø©", "but=Ù„ÙƒÙ†", "what=Ù…Ø§", "some=Ø¨Ø¹Ø¶", "time=ÙˆÙ‚Øª",
                "number=Ø±Ù‚Ù…", "people=Ù†Ø§Ø³", "water=Ù…Ø§Ø¡", "day=ÙŠÙˆÙ…", "part=Ø¬Ø²Ø¡", "sound=ØµÙˆØª", "work=Ø¹Ù…Ù„",
                "place=Ù…ÙƒØ§Ù†", "year=Ø³Ù†Ø©", "back=Ø®Ù„Ù", "thing=Ø´ÙŠØ¡", "name=Ø§Ø³Ù…", "sentence=Ø¬Ù…Ù„Ø©", "man=Ø±Ø¬Ù„",
                "line=Ø®Ø·", "boy=ÙˆÙ„Ø¯", "life=Ø­ÙŠØ§Ø©", "end=Ù†Ù‡Ø§ÙŠØ©", "house=Ù…Ù†Ø²Ù„", "picture=ØµÙˆØ±Ø©", "try=ÙŠØ­Ø§ÙˆÙ„",
                "us=Ù†Ø§", "again=Ù…Ø±Ø© Ø£Ø®Ø±Ù‰", "animal=Ø­ÙŠÙˆØ§Ù†", "point=Ù†Ù‚Ø·Ø©", "mother=Ø£Ù…", "world=Ø¹Ø§Ù„Ù…",
                "computer=Ø­Ø§Ø³ÙˆØ¨", "laptop=Ø­Ø§Ø³ÙˆØ¨ Ù…Ø­Ù…ÙˆÙ„", "desktop=Ø­Ø§Ø³ÙˆØ¨ Ù…ÙƒØªØ¨ÙŠ", "server=Ø®Ø§Ø¯Ù…", "device=Ø¬Ù‡Ø§Ø²",
                "hardware=Ø¹ØªØ§Ø¯", "software=Ø¨Ø±Ù…Ø¬ÙŠØ§Øª", "application=ØªØ·Ø¨ÙŠÙ‚", "program=Ø¨Ø±Ù†Ø§Ù…Ø¬", "system=Ù†Ø¸Ø§Ù…",
                "network=Ø´Ø¨ÙƒØ©", "internet=Ø¥Ù†ØªØ±Ù†Øª", "website=Ù…ÙˆÙ‚Ø¹ ÙˆÙŠØ¨", "browser=Ù…ØªØµÙØ­", "email=Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",
                "phone=Ù‡Ø§ØªÙ", "mobile=Ù…ØªØ­Ø±Ùƒ", "smartphone=Ù‡Ø§ØªÙ Ø°ÙƒÙŠ", "tablet=Ù„ÙˆØ­ÙŠ", "camera=ÙƒØ§Ù…ÙŠØ±Ø§",
                "screen=Ø´Ø§Ø´Ø©", "keyboard=Ù„ÙˆØ­Ø© Ù…ÙØ§ØªÙŠØ­", "mouse=ÙØ£Ø±Ø©", "printer=Ø·Ø§Ø¨Ø¹Ø©", "memory=Ø°Ø§ÙƒØ±Ø©",
                "storage=ØªØ®Ø²ÙŠÙ†", "file=Ù…Ù„Ù", "folder=Ù…Ø¬Ù„Ø¯", "data=Ø¨ÙŠØ§Ù†Ø§Øª", "information=Ù…Ø¹Ù„ÙˆÙ…Ø§Øª"
            ];

            let addedCount = 0;
            defaultWords.forEach(wordPair => {
                if (wordPair.includes('=')) {
                    const [english, arabic] = wordPair.split('=').map(part => part.trim());
                    if (english && arabic) {
                        // Check if word already exists
                        const exists = words.some(w => w.english.toLowerCase() === english.toLowerCase());
                        if (!exists) {
                            const wrongTranslations = generateWrongTranslations(arabic);
                            words.push({
                                english: english,
                                correct: arabic,
                                wrong1: wrongTranslations[0],
                                wrong2: wrongTranslations[1]
                            });
                            addedCount++;
                        }
                    }
                }
            });

            saveWords();
            updateStats();
            alert(`âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${addedCount} ÙƒÙ„Ù…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!`);
            document.getElementById('addWordsPanel').style.display = 'none';
        }

        // Show session statistics
        function showSessionStats() {
            const panel = document.getElementById('sessionStats');
            const addPanel = document.getElementById('addWordsPanel');
            panel.style.display = 'block';
            addPanel.style.display = 'none';
            
            const percentage = sessionAnswers > 0 ? Math.round((sessionCorrect / sessionAnswers) * 100) : 0;
            
            document.getElementById('sessionInfo').textContent = `ØªÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ ${sessionAnswers} ÙƒÙ„Ù…Ø©`;
            document.getElementById('sessionCorrect').textContent = `Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©: ${sessionCorrect}`;
            document.getElementById('sessionPercentage').textContent = `Ø§Ù„Ù†Ø³Ø¨Ø©: ${percentage}%`;
            document.getElementById('progressFill').style.width = `${percentage}%`;
            document.getElementById('progressFill').textContent = `${percentage}%`;
        }

        // Hide session statistics
        function hideSessionStats() {
            document.getElementById('sessionStats').style.display = 'none';
        }

        // Reset session
        function resetSession() {
            sessionAnswers = 0;
            sessionCorrect = 0;
            hideSessionStats();
            showRandomWord();
        }

        // Initialize app when page loads
        window.addEventListener('load', init);

        // Service Worker registration for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('sw.js')
                    .then(function(registration) {
                        console.log('âœ… ServiceWorker registered successfully');
                    })
                    .catch(function(error) {
                        console.log('âŒ ServiceWorker registration failed: ', error);
                    });
            });
        }
    </script>
</body>
</html>